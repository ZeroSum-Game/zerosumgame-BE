<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSum Game Demo</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; text-align: center; background-color: #f0f2f5; margin: 0; padding: 20px; }
        h1 { margin-top: 10px; color: #333; }
        .status-bar { background: #fff; padding: 10px; border-radius: 8px; display: inline-block; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .connection-status { color: #ff4757; font-weight: bold; }
        .connection-status.on { color: #2ed573; }
        
        /* ê²Œì„íŒ ë ˆì´ì•„ì›ƒ */
        .board-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            max-width: 1000px;
            margin: 0 auto;
            background: #ddd;
            padding: 10px;
            border-radius: 10px;
        }

        .cell {
            border: 1px solid #ddd;
            padding: 10px 5px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 80px;
            background-color: #fff;
            position: relative;
        }

        /* ì¹¸ ì¢…ë¥˜ë³„ ìƒ‰ìƒ (í•˜ì€ë‹˜ ê¸°ì¡´ ì„¤ì • ìœ ì§€) */
        .START { background-color: #ffeba7; }
        .LAND { background-color: #e3f2fd; }
        .STOCK { background-color: #ffe0b2; color: #e65100; }
        .JAIL { background-color: #cfd8dc; }
        .KEY { background-color: #fff9c4; }
        .MINI { background-color: #f8bbd0; }
        .EXPO { background-color: #e1bee7; }
        .ISLAND { background-color: #b2dfdb; }
        .TAX { background-color: #ffccbc; }

        .price { font-size: 10px; color: #666; margin-top: 5px; }
        .idx { position: absolute; top: 2px; left: 5px; font-size: 8px; color: #aaa; }
    </style>
</head>
<body>

    <h1>ğŸ² ì œë¡œì„¬ ê²Œì„ (ZeroSum)</h1>
    
    <div class="status-bar">
        ìƒíƒœ: <span id="status" class="connection-status">ì—°ê²° ì‹œë„ ì¤‘...</span> | 
        ID: <span id="my-id">-</span>
    </div>

    <div class="board-container" id="board">ë§µì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <script>
        // --- 1. ì†Œì¼“ ì—°ê²° ë° ì´ë²¤íŠ¸ ì„¤ì • ---
        const socket = io();
        const statusEl = document.getElementById('status');
        const idEl = document.getElementById('my-id');

        // ì—°ê²° ì„±ê³µ ì‹œ
        socket.on("connect", () => {
            statusEl.innerText = "ì—°ê²°ë¨ âœ…";
            statusEl.className = "connection-status on";
            idEl.innerText = socket.id;
            
            // ì„œë²„ì— 1ë²ˆ ë°© ì…ì¥ ìš”ì²­ (ê³„íší‘œëŒ€ë¡œ!)
            socket.emit("join_room", 1);
        });

        // ì…ì¥ ì„±ê³µ ì•Œë¦¼ ë°›ê¸°
        socket.on("join_success", (data) => {
            console.log("ğŸ“¢ ì„œë²„ ë©”ì‹œì§€:", data.message);
        });

        // ë‹¤ë¥¸ ìœ ì € ì…ì¥ ì‹œ ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë°›ê¸°
        socket.on("system_msg", (data) => {
            console.log("ğŸ”” ì•Œë¦¼:", data.message);
            // ê°€ë³ê²Œ ì½˜ì†”ì´ë‚˜ ì•Œë¦¼ì°½ìœ¼ë¡œ í™•ì¸
        });

        // ì—°ê²° ëŠê¹€ ì‹œ
        socket.on("disconnect", () => {
            statusEl.innerText = "ì—°ê²° ëŠê¹€ âŒ";
            statusEl.className = "connection-status";
        });


        // --- 2. APIë¥¼ ì´ìš©í•œ ë§µ ë°ì´í„° ë¡œë”© ---
        async function loadMap() {
            try {
                const response = await fetch('/api/map');
                const mapData = await response.json();

                const boardDiv = document.getElementById('board');
                boardDiv.innerHTML = ''; 

                mapData.forEach(node => {
                    const cell = document.createElement('div');
                    cell.className = `cell ${node.type}`;
                    
                    let priceText = '';
                    if (node.basePrice > 0) {
                        priceText = `<div class="price">â‚©${Number(node.basePrice).toLocaleString()}</div>`;
                    }
                    
                    cell.innerHTML = `
                        <span class="idx">${node.nodeIdx}</span>
                        <span>${node.name}</span>
                        ${priceText}
                    `;
                    boardDiv.appendChild(cell);
                });
            } catch (error) {
                console.error("ë§µ ë¡œë”© ì‹¤íŒ¨:", error);
                document.getElementById('board').innerText = "ë§µ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë§µ ì‹¤í–‰
        loadMap();
    </script>
</body>
</html>